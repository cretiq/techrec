# Cover Letter Generation Debug Workflow

**üîç CLEANED DEBUG SYSTEM** for AI-powered cover letter generation.

## **Environment Setup**
```bash
# Add to .env.local for permanent debugging (recommended):
DEBUG_COVER_LETTER=true
NODE_ENV=development

# Or set per-command for one-off analysis:
DEBUG_COVER_LETTER=true NODE_ENV=development [command]
```

## **Three-File Debug System**
**üöÄ ENHANCED WORKFLOW**: Each cover letter generation creates three files in `/logs/cover-letter-generation/`:

1. **`{sessionId}-unified-debug.json`** - Complete debug data with metadata
2. **`{sessionId}-raw-content.json`** - **NEW!** Clean file with only 3 essential fields
3. **`{sessionId}-analysis.json`** - Analysis results and recommendations

## **Cleaned Unified Structure**
**Main Content Fields** (at top level):
1. **`rawPromptTemplate`** - Template with variable placeholders (`${variable}`)
2. **`fullPrompt`** - Final prompt with variables substituted  
3. **`aiResponse`** - Generated cover letter content

**Metadata Sections**:
- **`metadata.templateInfo`**: Expansion ratio, variable count, template type
- **`metadata.responseInfo`**: Duration, word count, validation status, model used
- **`metadata.requestInfo`**: Role, company, content type, cache status
- **`fullContext`**: Complete request/response data for comprehensive debugging

## **Raw Content File**
**üéØ NEW FEATURE**: The analysis script automatically creates a lightweight `{sessionId}-raw-content.json` file containing ONLY:

```json
{
  "rawPromptTemplate": "SYSTEM:\nYou are ${role}...",
  "fullPrompt": "SYSTEM:\nYou are an elite copywriter...", 
  "aiResponse": "Dear Hiring Team,\nI am writing..."
}
```

**Perfect for**: Quick content access, template comparison, AI response extraction, external tool integration.

## **Debug File Generation**
**Automatic during cover letter generation** - When debug is enabled:

```
üìÅ /logs/cover-letter-generation/
‚îú‚îÄ‚îÄ 2025-08-14T12-30-45-123Z-unified-debug.json    # Complete debug data
‚îú‚îÄ‚îÄ 2025-08-14T12-30-45-123Z-raw-content.json     # NEW: Clean 3-field file  
‚îî‚îÄ‚îÄ 2025-08-14T12-30-45-123Z-analysis.json        # Generated by script
```

## **Debug Analysis Script**
**Enhanced analysis** - Run after cover letter generation:

```bash
DEBUG_COVER_LETTER=true NODE_ENV=development npx tsx scripts/analyze-cover-letter-generation.ts
```

**New Features**:
- ‚úÖ **Auto-creates raw content file** with just the 3 essential fields
- ‚úÖ **Comprehensive prompt analysis** with template expansion ratios
- ‚úÖ **Quality metrics** and validation status
- ‚úÖ **Backward compatibility** with old debug file formats
- ‚úÖ **Direct field access paths** for easy content retrieval

## **Expected Output Structure**
```json
{
  "sessionId": "2025-08-14T12-30-45-123Z",
  "timestamp": "2025-08-14T12:30:45.123Z",
  "cached": false,
  "rawPromptTemplate": "SYSTEM:\nYou are ${role}...",
  "fullPrompt": "SYSTEM:\nYou are an elite copywriter...", 
  "aiResponse": "Dear Hiring Team,\nI am writing...",
  "metadata": {
    "templateInfo": {
      "templateType": "MVP Content Template",
      "expansionRatio": "3.02",
      "variableCount": 47
    },
    "responseInfo": {
      "duration": 2500,
      "wordCount": 287,
      "validationPassed": true
    }
  },
  "fullContext": { /* complete request/response data */ }
}
```

## **Usage Examples**
```bash
# Generate cover letter with debug enabled
DEBUG_COVER_LETTER=true npm run dev

# Analyze latest session
DEBUG_COVER_LETTER=true npx tsx scripts/analyze-cover-letter-generation.ts

# Check debug files created
ls -la logs/cover-letter-generation/
```

## **Related Files**
- **API Route**: `app/api/generate-cover-letter/route.ts` - Cover letter generation API with unified debug
- **Debug Logger**: `utils/debugLogger.ts` - CoverLetterDebugLogger unified file system
- **Analysis Script**: `scripts/analyze-cover-letter-generation.ts` - Debug analysis tool
- **Output Directory**: `logs/cover-letter-generation/` - Debug files location